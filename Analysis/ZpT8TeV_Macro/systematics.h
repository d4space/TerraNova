
// U N F O L D I N G    P A R    R E S O L U T I O N

// U N F O L D I N G    S H A P E, SF=0.85 and SF=1.25
double ptUnfoldingShapeSyst_plus[18] = {
                                         0.00000400,
                                         0.00000515,
                                         0.00000775,
                                         0.00000173,
                                         0.00000044,
                                         0.00000058,
                                         0.00000191,
                                         0.00000135,
                                         0.00000154,
                                         0.00000047,
                                         0.00000008,
                                         0.00000020,
                                         0.00000014,
                                         0.00000014,
                                         0.00000000,
                                         0.00000001,
                                         0.00000001100,
                                         0.00000000001 
                                        };


double ptUnfoldingShapeSyst_minus[18] = {
                                          0.00000281,
                                          0.00000930,
                                          0.00000364,
                                          0.00000196,
	                                  0.00000383,
                                          0.00000031,
                                          0.00000454,
                                          0.00000171,
                                          0.00000088,
                                          0.00000062,
                                          0.00000045,
                                          0.00000016,
                                          0.00000002,
                                          0.00000000,
                                          0.00000008,
                                          0.00000001,
                                          0.00000000007,
                                          0.00000000136 
                                         };


        

// B A C K G R O U N D    S U B T R A C T I O N
            
  double ptBkgSyst_plus[18] = {
                              0.00014512,
                              0.00023114,
                              0.00021415,
                              0.00011173,
                              0.00010321,
                              0.00005561,
                              0.00003265,
                              0.00003759,
                              0.00000169,
                              0.00002375,
                              0.00003118,
                              0.00003287,
                              0.00002372,
                              0.00001423,
                              0.00000578,
                              0.00000152,
                              0.00000055,
                              0.00000009 
                             };


double ptBkgSyst_minus[18] = {
                               0.00014363,
                               0.00022876,
                               0.00021198,
                               0.00011058,
                               0.00010216,
                               0.00005504,
                               0.00003232,
                               0.00003720,
                               0.00000167,
                               0.00002399,
                               0.00003150,
                               0.00003321,
                               0.00002397,
                               0.00001438,
                               0.00000584,
                               0.00000153,
                               0.00000055,
                               0.00000009 
                              };
                            
                             


// U N F O L D I N G    P A R    R E S O L U T I O N (with double Gaussian)
double ptUnfoldSyst_doubleGaussin_plus[18] = {
                                               0.000006077,
                                               0.000008190,
                                               0.000004431,
                                               0.000003394,
                                               0.000001564,
                                               0.000001001,
                                               0.000000411,
                                               0.000001419,
                                               0.000000177,
                                               0.000000489,
                                               0.000000110,
                                               0.000000163,
                                               0.000000010,
                                               0.000000007,
                                               0.000000007,
                                               0.000000001,
                                               0.00000000004,
                                               0.00000000123 
                                              };


double ptUnfoldSyst_doubleGaussin_minus[18] = {
                                                0.000000856,
                                                0.000001552,
                                                0.000003008,
                                                0.000002112,
                                                0.000000641,
                                                0.000001026,
                                                0.000000980,
                                                0.000000133,
                                                0.000000339,
                                                0.000000307,
                                                0.000000092,
                                                0.000000048,
                                                0.000000148,
                                                0.000000146,
                                                0.000000002,
                                                0.000000003,
                                                0.00000000693,
                                                0.00000000000 
                                               };


                                              
//Efficiency systematics                                              
double ptEffSyst_plus[18] = {
                              0.000001941,
                              0.000002089,
                              0.000000319,
                              0.000000908,
                              0.000000698,
                              0.000000612,
                              0.000000661,
                              0.000000691,
                              0.000000108,
                              0.000000248,
                              0.000000021,
                              0.000000075,
                              0.000000014,
                              0.000000017,
                              0.000000001,
                              0.000000006,
                              0.000000001,
                              0.000000000 
                             };


double ptEffSyst_minus[18] = {
                               0.000000593,
                               0.000000889,
                               0.000002373,
                               0.000000590,
                               0.000000118,
                               0.000000229,
                               0.000000033,
                               0.000000018,
                               0.000000237,
                               0.000000002,
                               0.000000043,
                               0.000000021,
                               0.000000011,
                               0.000000003,
                               0.000000004,
                               0.000000004,
                               0.000000001,
                               0.000000000 
                              };


//Madgraph


double ptSystMadgraph_plus[18] = {
                              0.00090357, 
			      0.00073026, 
			      0.00014385, 
			      0.00050344, 
			      0.00050843, 
			      0.00055764, 
			      0.00029025, 
			      0.00028008, 
			      0.00004866, 
			      0.00003656, 
			      0.00004129, 
			      0.00000561, 
			      0.00000326, 
			      0.00000273, 
			      0.00000189, 
			      0.00000011, 
			      0.00000089, 
			      0.00000002 };

double ptSystMadgraph_minus[18] = {
                              0.00090357, 
			      0.00073026, 
			      0.00014385, 
			      0.00050344, 
			      0.00050843, 
			      0.00055764, 
			      0.00029025, 
			      0.00028008, 
			      0.00004866, 
			      0.00003656, 
			      0.00004129, 
			      0.00000561, 
			      0.00000326, 
			      0.00000273, 
			      0.00000189, 
			      0.00000011, 
			      0.00000089, 
			      0.00000002 };


//-----Acceptance correction-----
double ptAccSyst_plus[18] = {
                              0.00013368,
                              0.00016758,
                              0.00006861,
                              0.00002677,
                              0.00001256,
                              0.00000900,
                              0.00002268,
                              0.00002440,
                              0.00001646,
                              0.00001719,
                              0.00001693,
                              0.00001264,
                              0.00000672,
                              0.00000352,
                              0.00000181,
                              0.00000085,
                              0.00000010,
                              0.00000005 
                             };


double ptAccSyst_minus[18] = {
                               0.00015581,
                               0.00020012,
                               0.00007948,
                               0.00003783,
                               0.00001998,
                               0.00000828,
                               0.00001917,
                               0.00002046,
                               0.00001741,
                               0.00001449,
                               0.00001380,
                               0.00000985,
                               0.00000515,
                               0.00000262,
                               0.00000135,
                               0.00000061,
                               0.00000008,
                               0.00000003 
                              };


double ptFSRSyst_plus[18] = {0.00000851, 
			     0.00001015, 
			     0.00000583, 
			     0.00000278, 
			     0.00000458, 
			     0.00000755, 
			     0.00000487, 
			     0.00000601, 
			     0.00000191, 
			     0.00000009, 
			     0.00000053, 
			     0.00000051, 
			     0.00000039, 
			     0.00000004, 
			     0.00000022, 
			     0.00000014, 
			     0.00000003, 
			     0.00000001};

double ptFSRSyst_minus[18] = {0.00000851, 
			     0.00001015, 
			     0.00000583, 
			     0.00000278, 
			     0.00000458, 
			     0.00000755, 
			     0.00000487, 
			     0.00000601, 
			     0.00000191, 
			     0.00000009, 
			     0.00000053, 
			     0.00000051, 
			     0.00000039, 
			     0.00000004, 
			     0.00000022, 
			     0.00000014, 
			     0.00000003, 
			     0.00000001};


/*
double calcErrP(double A, double A_err,
                double B, double B_err) {

                  (derVersusB*derVersusB*B_err*B_err) ); 

  double derVersusA = B; 
  double derVersusB = A; 

  return TMath::Sqrt( (derVersusA*derVersusA*A_err*A_err) + 
                      (derVersusB*derVersusB*B_err*B_err) );

}
*/

void fillSystErrorEff(TGraphAsymmErrors* gXSec,
                      TGraphAsymmErrors* gXSecWithSyst) {

  const int nptBins = 18;
  Double_t xbins_pt[nptBins+1] = {0, 2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20, 30, 40, 50, 70, 90, 110, 150, 190, 250, 600};

  std::cout << "systematic error\n" << std::endl;
  for(int bin=0; bin<gXSec->GetN(); bin++){

    double x = -999;
    double value = -999;
    gXSec->GetPoint(bin,x,value); 
    
    double sigma_low  = gXSec->GetErrorYlow (bin); 
    double sigma_high = gXSec->GetErrorYhigh(bin); 

    double syst2plus = TMath::Power(ptBkgSyst_plus[bin],2)+   
      TMath::Power(ptUnfoldingShapeSyst_plus[bin],2)+ 
      TMath::Power(ptUnfoldSyst_doubleGaussin_plus[bin],2)+
      TMath::Power(ptEffSyst_plus[bin],2)+ 
      TMath::Power(ptSystMadgraph_plus[bin],2) +
      TMath::Power(ptFSRSyst_plus[bin],2);
      //      TMath::Power(ptAccSyst_plus[bin],2);


    double syst2minus = TMath::Power(ptBkgSyst_minus[bin],2)+   
      TMath::Power(ptUnfoldingShapeSyst_minus[bin],2)+
      TMath::Power(ptUnfoldSyst_doubleGaussin_minus[bin],2)+
      TMath::Power(ptEffSyst_minus[bin],2) +
      TMath::Power(ptSystMadgraph_minus[bin],2)+
      TMath::Power(ptFSRSyst_minus[bin],2);
    //   TMath::Power(ptAccSyst_minus[bin],2);
     
    double systplus  = TMath::Sqrt(syst2plus );
    double systminus = TMath::Sqrt(syst2minus);

    //cout << systplus << " & "<< systminus << "\\\\" <<std::endl;
    //cout << "\\hline"<< std::endl;

    double errorplus  = TMath::Sqrt( TMath::Power(sigma_high,2) + TMath::Power(systplus ,2) );
    double errorminus = TMath::Sqrt( TMath::Power(sigma_low ,2) + TMath::Power(systminus,2) );

    double Error = TMath::Sqrt( TMath::Power(errorplus,2) + TMath::Power(systplus, 2) );

    //    double FracError = systminus/value;
    //printf("%8.8f \n",
    //   FracError);

    gXSecWithSyst->SetPoint(bin,x,value);
    //gXSecWithSyst->SetPointError(bin,0,0,errorplus, errorminus);

    //double binwidth = gXSec->GetErrorXhigh(bin);
    double xerrorl = gXSec->GetErrorXlow(bin);
    double xerrorh = gXSec->GetErrorXhigh(bin);
    gXSecWithSyst->SetPointError(bin,xerrorl,xerrorh,errorplus, errorminus);

 
    //double errorplusCorr  = calcErrP(value,errorplus ,fsrCorrection[bin],fsrCorrectionErr[bin]);
    //double errorminusCorr = calcErrP(value,errorminus,fsrCorrection[bin],fsrCorrectionErr[bin]);
 
   
    //   printf("%2d & %2.1f-%2.1f & %8.8f & +%8.8f  & -%8.8f  \\\\\n\\hline\n", 
    //     bin,gXSec->GetErrorXlow(bin),gXSec->GetErrorXhigh(bin),value,errorplus,errorminus); 

    	   printf("%2d & %2.1f-%2.1f & %8.8f & +%8.8f  & -%8.8f  \\\\\n\\hline\n", 
     	  bin+1, xbins_pt[bin],xbins_pt[bin+1],value,errorplus,errorminus); 
    //    printf("%2d & %2.1f-%2.1f  & +%8.8f  & -%8.8f  \\\\\n\\hline\n", 
    //	         bin+1, xbins_pt[bin],xbins_pt[bin+1],systplus,systminus); 

    //pre-fsr
    //printf("%2d & %2.1f-%2.1f & %8.8f & +%8.8f  & -%8.8f  \\\\\n\\hline\n",
    //       bin,gXSec->GetErrorXlow(bin),gXSec->GetErrorXhigh(bin),value*fsrCorrection[bin],errorplusCorr,errorminusCorr);
    
  }
}



/*
void fillSystErrorEffHighPt(TGraphAsymmErrors* gXSec,
                            TGraphAsymmErrors* gXSecWithSyst) {


  for(int bin=0; bin<gXSec->GetN(); bin++){

    double x = -999;
    double value = -999;
    gXSec->GetPoint(bin,x,value); 
    
    double sigma_low  = gXSec->GetErrorYlow (bin); 
    double sigma_high = gXSec->GetErrorYhigh(bin); 

    double syst2plus = TMath::Power(ptBkgSyst_plus[bin+8],2)+
                       TMath::Power(ptEffSyst_plus[bin+8],2);+    
                       TMath::Power(ptUnfoldingResParsSyst_plus[bin+8],2) +
                       TMath::Power(ptUnfoldingShapeSyst_plus[bin+8],2);


    double syst2minus = TMath::Power(ptBkgSyst_minus[bin+8],2)+
                        TMath::Power(ptEffSyst_minus[bin+8],2)+    
                        TMath::Power(ptUnfoldingResParsSyst_minus[bin+8],2) +
                        TMath::Power(ptUnfoldingShapeSyst_minus[bin+8],2);


    double systplus  = TMath::Sqrt(syst2plus );
    double systminus = TMath::Sqrt(syst2minus);

    double errorplus  = TMath::Sqrt( TMath::Power(sigma_high,2) + TMath::Power(systplus ,2) );
    double errorminus = TMath::Sqrt( TMath::Power(sigma_low ,2) + TMath::Power(systminus,2) );

    gXSecWithSyst->SetPoint(bin,x,value);
    gXSecWithSyst->SetPointError(bin,0,0,errorplus, errorminus);

    //std::cout << x <<" - "<<value<<" +"<<sigma_high<<"(stat.) +"<<systplus<<"(syst.) ->"<<errorplus<<std::endl
    //          << "                   -"<<sigma_low<<"(stat.) +"<<systminus<<"(syst.) ->"<<errorminus<<std::endl;

  }


}


void fillSystErrorAccEff(TGraphAsymmErrors* gXSec,
                         TGraphAsymmErrors* gXSecWithSyst) {

*/
  /*
    double const fsrCorrection[18] = {1.07419  , //+/- 0.00443357
                                    1.03522  , //+/- 0.00345097
                                    1.0006   , //+/- 0.00368785
                                    0.979481 , //+/- 0.00401696
                                    0.967883 , //+/- 0.00442011
                                    0.961395 , //+/- 0.00485467
                                    0.960031 , //+/- 0.00533145
                                    0.959349 , //+/- 0.0058214
                                    0.972834 , //+/- 0.00368434
                                    0.998688 , //+/- 0.00527639
                                    1.01454  , //+/- 0.00715831
                                    1.01937  , //+/- 0.00745677
                                    1.02497  , //+/- 0.0121055
                                    1.03856  , //+/- 0.0193557
                                    1.03081  , //+/- 0.0235556
                                    1.07383  , //+/- 0.0507902
                                    1.03646  , //+/- 0.0747999
                                    1.10811  }; //+/- 0.182172

  double const fsrCorrectionErr[18] = {0.00443357, 
                                       0.00345097, 
                                       0.00368785, 
                                       0.00401696, 
                                       0.00442011, 
                                       0.00485467, 
                                       0.00533145, 
                                       0.0058214 , 
                                       0.00368434, 
                                       0.00527639, 
                                       0.00715831, 
                                       0.00745677, 
                                       0.0121055 , 
                                       0.0193557 , 
                                       0.0235556 , 
                                       0.0507902 , 
                                       0.0747999 , 
                                       0.182172  };
  */
/*
  std::cout << "systematic error\n";
  for(int bin=0; bin<gXSec->GetN(); bin++){

    double x = -999;
    double value = -999;
    gXSec->GetPoint(bin,x,value); 
    
    double sigma_low  = gXSec->GetErrorYlow (bin); 
    double sigma_high = gXSec->GetErrorYhigh(bin); 

    double syst2plus = TMath::Power(ptBkgSyst_plus[bin],2)+
                       TMath::Power(ptEffSyst_plus[bin],2)+    
                       TMath::Power(ptAccEffSyst_plus[bin],2)+
                       TMath::Power(ptUnfoldingResParsSyst_plus[bin],2) +
                       TMath::Power(ptUnfoldingShapeSyst_plus[bin],2);


    double syst2minus = TMath::Power(ptBkgSyst_minus[bin],2)+
                        TMath::Power(ptEffSyst_minus[bin],2)+    
                        TMath::Power(ptAccEffSyst_minus[bin],2)+
                        TMath::Power(ptUnfoldingResParsSyst_minus[bin],2) +
                        TMath::Power(ptUnfoldingShapeSyst_minus[bin],2);


    double systplus  = TMath::Sqrt(syst2plus );
    double systminus = TMath::Sqrt(syst2minus);

    //    cout << systplus << " & "<< systminus << "\\\\" <<std::endl;
    printf("%8.8f & %8.8f \\\\\n", systplus, systminus); 
    cout << "\\hline"<< std::endl;

    double errorplus  = TMath::Sqrt( TMath::Power(sigma_high,2) + TMath::Power(systplus ,2) );
    double errorminus = TMath::Sqrt( TMath::Power(sigma_low ,2) + TMath::Power(systminus,2) );

    gXSecWithSyst->SetPoint(bin,x,value);
    gXSecWithSyst->SetPointError(bin,0,0,errorplus, errorminus);

    //double errorplusCorr  = calcErrP(value,errorplus ,fsrCorrection[bin],fsrCorrectionErr[bin]);
    //double errorminusCorr = calcErrP(value,errorminus,fsrCorrection[bin],fsrCorrectionErr[bin]);

    //printf("%2d & %2.1f-%2.1f & %8.8f & +%8.8f  & -%8.8f  \\\\\n\\hline\n",
           //bin,gXSecWithSyst->GetErrorXlow(bin),gXSecWithSyst->GetErrorXhigh(bin),value,errorplus,errorminus);

   
    //pre-fsr
    //printf("%2d & %2.1f-%2.1f & %8.8f & +%8.8f  & -%8.8f  \\\\\n\\hline\n",
    //       bin,gXSec->GetErrorXlow(bin),gXSec->GetErrorXhigh(bin),value*fsrCorrection[bin],errorplusCorr,errorminusCorr);

  }


}


void fillSystErrorAccEffHighPt(TGraphAsymmErrors* gXSec,
                               TGraphAsymmErrors* gXSecWithSyst) {


  for(int bin=0; bin<gXSec->GetN(); bin++){

    double x = -999;
    double value = -999;
    gXSec->GetPoint(bin,x,value); 
    
    double sigma_low  = gXSec->GetErrorYlow (bin); 
    double sigma_high = gXSec->GetErrorYhigh(bin); 

    double syst2plus = TMath::Power(ptBkgSyst_plus[bin+8],2)+
                       TMath::Power(ptEffSyst_plus[bin+8],2)+    
                       TMath::Power(ptAccEffSyst_plus[bin+8],2)+
                       TMath::Power(ptUnfoldingResParsSyst_plus[bin+8],2) +
                       TMath::Power(ptUnfoldingShapeSyst_plus[bin+8],2);


    double syst2minus = TMath::Power(ptBkgSyst_minus[bin+8],2)+
                        TMath::Power(ptEffSyst_minus[bin+8],2)+    
                        TMath::Power(ptAccEffSyst_minus[bin+8],2)+
                        TMath::Power(ptUnfoldingResParsSyst_minus[bin+8],2) +
                        TMath::Power(ptUnfoldingShapeSyst_minus[bin+8],2);


    double systplus  = TMath::Sqrt(syst2plus );
    double systminus = TMath::Sqrt(syst2minus);

    gXSecWithSyst->SetPoint(bin,x,value);
    gXSecWithSyst->SetPointError(bin,0,0,sigma_high+systplus,sigma_low+systminus);
  }


}


*/
